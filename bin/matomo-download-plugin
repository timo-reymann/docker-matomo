#!/bin/bash
set -eo pipefail

plugin="$1"

if [[ -z "$plugin" ]]
then
  echo "[download-plugin] Please specify plugin as first argument" >&2
  exit 2
fi

if [[ -d "/app/plugins/$plugin" ]];
then
  echo "[download-plugin] Plugin $plugin already installed"
  exit 0
fi

echo "[download-plugin] Download $plugin from Marketplace"
curl -f -sS https://plugins.matomo.org/api/2.0/plugins/$plugin/download/latest?matomo=$MATOMO_VERSION -o /tmp/plugins-$plugin.zip;
(cd /app/plugins && unzip /tmp/plugins-$plugin.zip)
rm /tmp/plugins-$plugin.zip

